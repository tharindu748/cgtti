generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      Role     @default(MEMBER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  member    Member?

  @@map("users")
}

model Member {
  id               String            @id @default(cuid())
  trainingNumber   String            @unique
  membershipYear   Int
  trade            Trade
  name             String
  district         String
  membershipNumber String            @unique
  address          String
  mobile           String
  nic              String
  email            String?
  paymentStatus    PaymentStatus     @default(NON_PAID)
  livingStatus     LivingStatus      @default(ALIVE)
  isVerified       Boolean           @default(false)
  userId           String?           @unique
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  GeneratedLetter  GeneratedLetter[]
  user             User?             @relation(fields: [userId], references: [id])

  @@map("members")
}

model LetterTemplate {
  id              String            @id @default(cuid())
  name            String
  subject         String
  content         String
  createdBy       String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  GeneratedLetter GeneratedLetter[]

  @@map("letter_templates")
}

model GeneratedLetter {
  id          String          @id @default(cuid())
  memberId    String
  templateId  String?
  subject     String
  content     String
  reason      String
  generatedBy String
  createdAt   DateTime        @default(now())
  member      Member          @relation(fields: [memberId], references: [id])
  template    LetterTemplate? @relation(fields: [templateId], references: [id])

  @@map("generated_letters")
}

enum Role {
  ADMIN
  MEMBER
}

enum Trade {
  TOOL_MACHINE
  MILLWRIGHT
  AUTO_MOBILE
  BBP
  AUTO_ELECTRICAL
  REF_AND_AC
  MECHATRONIC
  DISAL_PUMP
  WELDING
  POWER_ELECTRICAL
}

enum PaymentStatus {
  PAID
  NON_PAID
}

enum LivingStatus {
  ALIVE
  DECEASED
}

// Add after the existing models
model Event {
  id                  String   @id @default(cuid())
  title               String
  description         String
  shortDescription    String?
  
  // Date and time
  eventDate           DateTime
  startTime           String
  endTime             String
  
  // Location
  location            String
  address             String
  city                String
  country             String
  
  // Type and category
  eventType           EventType @default(IN_PERSON)
  category            EventCategory @default(GENERAL)
  tags                String[]
  
  // Status and visibility
  status              EventStatus @default(DRAFT)
  visibility          EventVisibility @default(PUBLIC)
  
  // Registration settings
  registrationType    RegistrationType @default(FREE)
  price               Decimal? @default(0)
  currency            String? @default("LKR")
  capacity            Int @default(100)
  waitlistEnabled     Boolean @default(false)
  registrationDeadline DateTime?
  
  // Media
  coverImage          String?
  galleryImages       String[]
  
  // Organizer info
  organizerName       String
  organizerEmail      String
  organizerPhone      String?
  
  // Additional details
  agenda              Json? // Store as JSON array
  speakers            Json? // Store as JSON array
  
  // Statistics
  registeredCount     Int @default(0)
  attendedCount       Int @default(0)
  
  // Timestamps
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  publishedAt         DateTime?
  
  // Relations
  registrations       EventRegistration[]
  createdBy           String
  updatedBy           String
  
  @@map("events")
}

model EventRegistration {
  id                  String   @id @default(cuid())
  eventId             String
  event               Event    @relation(fields: [eventId], references: [id])
  
  memberId            String
  member              Member   @relation(fields: [memberId], references: [id])
  
  // Registration details
  registrationDate    DateTime @default(now())
  status              RegistrationStatus @default(PENDING)
  ticketNumber        String? @unique
  notes               String?
  
  // Payment info
  paymentStatus       PaymentStatus @default(NON_PAID)
  paymentAmount       Decimal?
  paymentMethod       String?
  paymentDate         DateTime?
  paymentReference    String?
  
  // Attendance tracking
  checkInTime         DateTime?
  checkOutTime        DateTime?
  
  // Additional info
  guests              Int @default(0)
  dietaryRequirements String?
  specialRequests     String?
  
  // Timestamps
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@unique([eventId, memberId])
  @@map("event_registrations")
}

// Enums for events
enum EventType {
  IN_PERSON
  VIRTUAL
  HYBRID
}

enum EventCategory {
  REUNION
  CAREER
  WORKSHOP
  SEMINAR
  CONFERENCE
  SOCIAL
  SPORTS
  NETWORKING
  CHARITY
  GENERAL
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
  COMPLETED
}

enum EventVisibility {
  PUBLIC
  PRIVATE
  ALUMNI_ONLY
}

enum RegistrationType {
  FREE
  PAID
  INVITE_ONLY
}

enum RegistrationStatus {
  PENDING
  CONFIRMED
  WAITLISTED
  CANCELLED
  ATTENDED
  NO_SHOW
}
